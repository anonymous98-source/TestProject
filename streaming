
Excellent upgrade ğŸ‘Œ â€” adding a Bar Chart beside the Pie Chart makes your dashboard look like a proper financial analytics tool.

Weâ€™ll implement this cleanly using JFreeChart, and place:

[ Pie Chart ]   [ Bar Chart ]

Side-by-side inside the right panel.


---

ğŸ¯ Final Result

Right side of dashboard will show:

ğŸ¥§ Pie Chart â†’ Expenses vs Savings (group summary)

ğŸ“Š Bar Chart â†’ Category-wise Allocation (visual comparison)


Clean, professional layout.


---

ğŸ§  DESIGN APPROACH

Currently:

PieChartPanel (top)
Tables (bottom)

We will change to:

Charts SplitPane (Pie | Bar)
Tables below

So:

Top half â†’ Charts (horizontal split)

Bottom half â†’ Tables



---

âœ… STEP 1 â€” Create BarChartPanel

Create new file:

BarChartPanel.java


---

âœ… FULL BarChartPanel.java

package com.fundsmanager.ui;

import com.fundsmanager.model.FundAllocation;
import org.jfree.chart.ChartFactory;
import org.jfree.chart.ChartPanel;
import org.jfree.chart.JFreeChart;
import org.jfree.chart.plot.CategoryPlot;
import org.jfree.chart.renderer.category.BarRenderer;
import org.jfree.data.category.DefaultCategoryDataset;

import javax.swing.*;
import java.awt.*;
import java.util.List;

public class BarChartPanel extends JPanel {

    private final JPanel chartHolder;

    public BarChartPanel() {
        setLayout(new BorderLayout());
        setBorder(BorderFactory.createTitledBorder("Category Allocation"));

        chartHolder = new JPanel(new BorderLayout());
        add(chartHolder, BorderLayout.CENTER);
    }

    public void updateChart(List<FundAllocation> allocations) {

        chartHolder.removeAll();

        if (allocations == null || allocations.isEmpty()) {
            repaint();
            return;
        }

        DefaultCategoryDataset dataset = new DefaultCategoryDataset();

        for (FundAllocation fa : allocations) {
            dataset.addValue(
                    fa.getAmount(),
                    "Amount",
                    fa.getCategory()
            );
        }

        JFreeChart chart = ChartFactory.createBarChart(
                "Category Allocation",
                "Category",
                "Amount",
                dataset
        );

        CategoryPlot plot = chart.getCategoryPlot();
        BarRenderer renderer = (BarRenderer) plot.getRenderer();

        renderer.setSeriesPaint(0, new Color(52, 152, 219));

        ChartPanel chartPanel = new ChartPanel(chart);
        chartPanel.setMouseWheelEnabled(true);

        chartHolder.add(chartPanel, BorderLayout.CENTER);

        revalidate();
        repaint();
    }

    public void clear() {
        chartHolder.removeAll();
        repaint();
    }
}


---

âœ… STEP 2 â€” Update MainFrame Layout

Open:

MainFrame.java


---

1ï¸âƒ£ Add Field

At top with other chart fields:

private BarChartPanel barChartPanel;


---

2ï¸âƒ£ Update createMainContent()

Replace this section:

pieChartPanel = new PieChartPanel();

With:

pieChartPanel = new PieChartPanel();
barChartPanel = new BarChartPanel();

// Split charts horizontally
JSplitPane chartsSplit = new JSplitPane(
        JSplitPane.HORIZONTAL_SPLIT,
        pieChartPanel,
        barChartPanel
);

chartsSplit.setDividerLocation(450);
chartsSplit.setResizeWeight(0.5);
chartsSplit.setOneTouchExpandable(true);


---

3ï¸âƒ£ Replace This Block

Find:

JSplitPane rightSplit = new JSplitPane(
        JSplitPane.VERTICAL_SPLIT,
        pieChartPanel,
        tablesSplit
);

Replace with:

JSplitPane rightSplit = new JSplitPane(
        JSplitPane.VERTICAL_SPLIT,
        chartsSplit,
        tablesSplit
);

rightSplit.setDividerLocation(350);
rightSplit.setResizeWeight(0.5);


---

âœ… STEP 3 â€” Update generateReport()

Inside generateReport() after updating pie chart:

Add:

barChartPanel.updateChart(lastAllocations);

So it becomes:

allocationTableModel.setData(lastAllocations);
groupSummaryTableModel.setData(lastGroupSummaries);

pieChartPanel.updateChart(lastGroupSummaries);
barChartPanel.updateChart(lastAllocations);


---

âœ… STEP 4 â€” Update Reset Method

Inside resetCategories() add:

barChartPanel.clear();


---

ğŸ¯ FINAL LAYOUT

------------------------------------------------------
 |             |                                       |
 |  Pie Chart  |   Bar Chart (Category Allocation)    |
 |             |                                       |
 ------------------------------------------------------
 |            Tables Section                          |
 ------------------------------------------------------


---

ğŸ† What You Now Have

âœ” Pie chart (group distribution)
âœ” Bar chart (category allocation)
âœ” Fully dynamic
âœ” Scroll + resize friendly
âœ” Export still works
âœ” Professional analytics dashboard


---

ğŸš€ Optional Next Upgrades

If you want, we can now add:

Value labels above bars

Currency formatting on axis

Gradient bars

Horizontal bar chart option

Toggle between Amount & Percentage view

Export both charts together in one image


Just tell me ğŸ‘





Excellent ğŸ‘Œ â€” now weâ€™re fixing real business-logic correctness, not just UI.

You have three problems:

1ï¸âƒ£ Exception messages are generic
2ï¸âƒ£ When removing a category â†’ percentage gets subtracted from Savings only
3ï¸âƒ£ Percentages can go negative or exceed 100%

Weâ€™ll fix this properly at model + validation level, not hacks.


---

ğŸ¯ FINAL RULES (Clear Business Logic)

âœ… Total percentage must ALWAYS = 100

âŒ No category percentage can be < 0

âŒ No category percentage can exceed 100

âŒ Removing a category must NOT push others into negative

âŒ System must not auto-adjust blindly


---

ğŸ”´ WHY YOUR CURRENT ISSUE HAPPENS

You likely have logic like:

remaining = 100 - total
savings.setPercentage(remaining);

When removing something:

It subtracts only from Savings

If removed percentage > savings â†’ Savings becomes negative âŒ


That is wrong design.


---

âœ… PROPER FIX STRATEGY

We will:

1. Remove auto-adjust logic from Savings


2. Validate totals strictly


3. Prevent invalid edits before they apply


4. Improve exception messages


5. Prevent negative values




---

âœ… STEP 1 â€” FIX CategoryTableModel

Open:

CategoryTableModel.java


---

ğŸ” Replace setValueAt(...) completely with this

@Override
public void setValueAt(Object value, int row, int column) {

    Category category = categories.get(row);

    if (column == 0) {
        // Rename
        if (!category.isLocked()) {
            category.setName(value.toString().trim());
        }
    }

    if (column == 1) {
        try {
            double newPercent = Double.parseDouble(value.toString());

            if (newPercent < 0) {
                throw new IllegalArgumentException(
                        "Percentage cannot be negative."
                );
            }

            if (newPercent > 100) {
                throw new IllegalArgumentException(
                        "Percentage cannot exceed 100."
                );
            }

            double totalWithoutCurrent = categories.stream()
                    .filter(c -> c != category)
                    .mapToDouble(Category::getPercentage)
                    .sum();

            if (totalWithoutCurrent + newPercent > 100) {
                throw new IllegalArgumentException(
                        "Total percentage cannot exceed 100%.\n"
                        + "Current total (excluding this): "
                        + totalWithoutCurrent
                );
            }

            category.setPercentage(newPercent);

        } catch (NumberFormatException ex) {
            throw new IllegalArgumentException(
                    "Please enter a valid numeric percentage value."
            );
        }
    }

    fireTableRowsUpdated(row, row);
}


---

âœ… STEP 2 â€” FIX removeCategory()

Replace your removeCategory(int row) method with:

public void removeCategory(int row) {

    Category category = categories.get(row);

    if (category.isLocked()) {
        throw new IllegalStateException(
                "Default categories cannot be removed."
        );
    }

    categories.remove(row);

    fireTableDataChanged();
}

ğŸš« NO auto redistribution
ğŸš« NO subtraction from savings

User must manually rebalance.

This is correct financial behavior.


---

âœ… STEP 3 â€” Improve Exception Handling in MainFrame

Modify your export / actions to show clean messages.

Example in generateReport():

Replace:

JOptionPane.showMessageDialog(this, "Total percentage must be exactly 100%");

With:

JOptionPane.showMessageDialog(
        this,
        "The total allocation must equal exactly 100%.\n"
        + "Please adjust your category percentages.",
        "Invalid Allocation",
        JOptionPane.WARNING_MESSAGE
);


---

âœ… STEP 4 â€” Catch Model Exceptions Properly

Wrap editing exceptions safely.

In MainFrame constructor add:

Thread.setDefaultUncaughtExceptionHandler((t, e) -> {
    JOptionPane.showMessageDialog(
            this,
            e.getMessage(),
            "Input Error",
            JOptionPane.ERROR_MESSAGE
    );
});

Now invalid edits show clean dialogs instead of crashing.


---

ğŸ¯ FINAL BEHAVIOR AFTER FIX

Editing:

âœ” Cannot enter negative
âœ” Cannot exceed 100
âœ” Cannot overflow total

Removing:

âœ” Removes category safely
âœ” Does NOT corrupt savings
âœ” Does NOT auto-adjust blindly

Generating Report:

âœ” Only works if total = 100
âœ” Shows proper validation message


---

ğŸ† Now Your Logic Is Financially Correct

No:

Silent redistribution

Hidden subtraction

Negative savings

Overflow errors


This is now banking-grade safe logic.


---

If you want next:

Auto-balance toggle (optional)

Highlight invalid rows instead of popup

Show remaining percentage live

Lock total to 100 auto-calc mode


Just say ğŸ‘