Excellent ğŸ‘Œ â€” now weâ€™re fixing real business-logic correctness, not just UI.

You have three problems:

1ï¸âƒ£ Exception messages are generic
2ï¸âƒ£ When removing a category â†’ percentage gets subtracted from Savings only
3ï¸âƒ£ Percentages can go negative or exceed 100%

Weâ€™ll fix this properly at model + validation level, not hacks.


---

ğŸ¯ FINAL RULES (Clear Business Logic)

âœ… Total percentage must ALWAYS = 100

âŒ No category percentage can be < 0

âŒ No category percentage can exceed 100

âŒ Removing a category must NOT push others into negative

âŒ System must not auto-adjust blindly


---

ğŸ”´ WHY YOUR CURRENT ISSUE HAPPENS

You likely have logic like:

remaining = 100 - total
savings.setPercentage(remaining);

When removing something:

It subtracts only from Savings

If removed percentage > savings â†’ Savings becomes negative âŒ


That is wrong design.


---

âœ… PROPER FIX STRATEGY

We will:

1. Remove auto-adjust logic from Savings


2. Validate totals strictly


3. Prevent invalid edits before they apply


4. Improve exception messages


5. Prevent negative values




---

âœ… STEP 1 â€” FIX CategoryTableModel

Open:

CategoryTableModel.java


---

ğŸ” Replace setValueAt(...) completely with this

@Override
public void setValueAt(Object value, int row, int column) {

    Category category = categories.get(row);

    if (column == 0) {
        // Rename
        if (!category.isLocked()) {
            category.setName(value.toString().trim());
        }
    }

    if (column == 1) {
        try {
            double newPercent = Double.parseDouble(value.toString());

            if (newPercent < 0) {
                throw new IllegalArgumentException(
                        "Percentage cannot be negative."
                );
            }

            if (newPercent > 100) {
                throw new IllegalArgumentException(
                        "Percentage cannot exceed 100."
                );
            }

            double totalWithoutCurrent = categories.stream()
                    .filter(c -> c != category)
                    .mapToDouble(Category::getPercentage)
                    .sum();

            if (totalWithoutCurrent + newPercent > 100) {
                throw new IllegalArgumentException(
                        "Total percentage cannot exceed 100%.\n"
                        + "Current total (excluding this): "
                        + totalWithoutCurrent
                );
            }

            category.setPercentage(newPercent);

        } catch (NumberFormatException ex) {
            throw new IllegalArgumentException(
                    "Please enter a valid numeric percentage value."
            );
        }
    }

    fireTableRowsUpdated(row, row);
}


---

âœ… STEP 2 â€” FIX removeCategory()

Replace your removeCategory(int row) method with:

public void removeCategory(int row) {

    Category category = categories.get(row);

    if (category.isLocked()) {
        throw new IllegalStateException(
                "Default categories cannot be removed."
        );
    }

    categories.remove(row);

    fireTableDataChanged();
}

ğŸš« NO auto redistribution
ğŸš« NO subtraction from savings

User must manually rebalance.

This is correct financial behavior.


---

âœ… STEP 3 â€” Improve Exception Handling in MainFrame

Modify your export / actions to show clean messages.

Example in generateReport():

Replace:

JOptionPane.showMessageDialog(this, "Total percentage must be exactly 100%");

With:

JOptionPane.showMessageDialog(
        this,
        "The total allocation must equal exactly 100%.\n"
        + "Please adjust your category percentages.",
        "Invalid Allocation",
        JOptionPane.WARNING_MESSAGE
);


---

âœ… STEP 4 â€” Catch Model Exceptions Properly

Wrap editing exceptions safely.

In MainFrame constructor add:

Thread.setDefaultUncaughtExceptionHandler((t, e) -> {
    JOptionPane.showMessageDialog(
            this,
            e.getMessage(),
            "Input Error",
            JOptionPane.ERROR_MESSAGE
    );
});

Now invalid edits show clean dialogs instead of crashing.


---

ğŸ¯ FINAL BEHAVIOR AFTER FIX

Editing:

âœ” Cannot enter negative
âœ” Cannot exceed 100
âœ” Cannot overflow total

Removing:

âœ” Removes category safely
âœ” Does NOT corrupt savings
âœ” Does NOT auto-adjust blindly

Generating Report:

âœ” Only works if total = 100
âœ” Shows proper validation message


---

ğŸ† Now Your Logic Is Financially Correct

No:

Silent redistribution

Hidden subtraction

Negative savings

Overflow errors


This is now banking-grade safe logic.


---

If you want next:

Auto-balance toggle (optional)

Highlight invalid rows instead of popup

Show remaining percentage live

Lock total to 100 auto-calc mode


Just say ğŸ‘