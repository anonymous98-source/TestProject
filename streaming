
import java.io.*;

import java.nio.channels.FileChannel;
import java.nio.file.Path;
import java.nio.file.Paths;
import java.nio.file.StandardOpenOption;
import java.time.Duration;
import java.time.LocalDateTime;
import java.time.format.DateTimeFormatter;


public class Streaming {

    public static void main(String[] args) throws Exception {


        LargeFileCopy largeFileCopy = new LargeFileCopy();
        largeFileCopy.streamFile();

        LargeFileCopyNIO largeFileCopyNIO = new LargeFileCopyNIO();
        largeFileCopyNIO.streamFiles();


    }
}

class LargeFileCopy extends Thread {

    public void streamFile() throws Exception {
        File source = new File("D:/bigfile.bin");
        File destination = new File("E:/bigfile.bin");

        try (InputStream in = new BufferedInputStream(new FileInputStream(source));
             OutputStream out = new BufferedOutputStream(new FileOutputStream(destination))) {

            byte[] buffer = new byte[1024 * 1024]; // 1 MB buffer
            int bytesRead;
            DateTimeFormatter formatter = DateTimeFormatter.ofPattern("yyyy-MM-dd HH:mm:ss");

            LocalDateTime startTime = LocalDateTime.now();
            System.out.println("Streaming started at :: " + startTime.format(formatter));
            while ((bytesRead = in.read(buffer)) != -1) {
                out.write(buffer, 0, bytesRead);
            }
            LocalDateTime endTime = LocalDateTime.now();
            System.out.println("Streaming ended at :: " + endTime.format(formatter));


            Duration duration = Duration.between(startTime, endTime);

            long hours = duration.toHours();
            long minutes = duration.toMinutesPart();
            long seconds = duration.toSecondsPart();


            System.out.println("Streaming complete using normal streaming , total time required for streaming :: " + hours + " hours, "
                    + minutes + " minutes, " + seconds + " seconds.");
        }


    }
}

class LargeFileCopyNIO extends Thread {

    public void streamFiles() throws Exception {
        Path source = Paths.get("D:/bigfile.bin");
        Path destination = Paths.get("E:/bigfile_copy.dat");
        DateTimeFormatter formatter = DateTimeFormatter.ofPattern("yyyy-MM-dd HH:mm:ss");


        LocalDateTime startTime = LocalDateTime.now();
        System.out.println("NIO Streaming started at :: " + startTime.format(formatter));
        try (FileChannel in = FileChannel.open(source, StandardOpenOption.READ);
             FileChannel out = FileChannel.open(destination,
                     StandardOpenOption.CREATE,
                     StandardOpenOption.WRITE,
                     StandardOpenOption.TRUNCATE_EXISTING)) {

            long size = in.size();
            long position = 0;

            while (position < size) {
                position += in.transferTo(position, 1024L * 1024L * 1024L, out);
            }
        }
        LocalDateTime endTime = LocalDateTime.now();
        System.out.println("NIO Streaming ended at :: " + endTime.format(formatter));


        Duration duration = Duration.between(startTime, endTime);

        long hours = duration.toHours();
        long minutes = duration.toMinutesPart();
        long seconds = duration.toSecondsPart();


        System.out.println("Streaming complete using NIO based streaming, total time required for streaming :: " + hours + " hours, "
                + minutes + " minutes, " + seconds + " seconds.");


        System.out.println("Copy done");
    }
}
