package com.fundsmanager.ui;

import com.fundsmanager.model.GroupSummary;
import com.fundsmanager.model.GroupType;
import org.jfree.chart.ChartFactory;
import org.jfree.chart.ChartPanel;
import org.jfree.chart.JFreeChart;
import org.jfree.chart.plot.PiePlot;
import org.jfree.data.general.DefaultPieDataset;

import javax.swing.*;
import java.awt.*;
import java.util.List;

public class PieChartPanel extends JPanel {

    private final JPanel chartHolder;

    public PieChartPanel() {
        setLayout(new BorderLayout());
        setBorder(BorderFactory.createTitledBorder("Expenses vs Savings"));

        chartHolder = new JPanel(new BorderLayout());
        chartHolder.setPreferredSize(new Dimension(420, 280));

        JScrollPane scrollPane = new JScrollPane(chartHolder);
        scrollPane.setHorizontalScrollBarPolicy(
                JScrollPane.HORIZONTAL_SCROLLBAR_NEVER
        );

        add(scrollPane, BorderLayout.CENTER);
    }

    // âœ… THIS IS THE CORRECT SIGNATURE
    public void updateChart(List<GroupSummary> summaries) {

        chartHolder.removeAll();

        if (summaries == null || summaries.isEmpty()) {
            repaint();
            return;
        }

        DefaultPieDataset dataset = new DefaultPieDataset();

        for (GroupSummary gs : summaries) {
            dataset.setValue(
                    gs.getGroupType().getDisplayName(),
                    gs.getTotalAmount()
            );
        }

        JFreeChart chart = ChartFactory.createPieChart(
                "Overall Distribution",
                dataset,
                true,
                true,
                false
        );

        PiePlot plot = (PiePlot) chart.getPlot();

        // ðŸŽ¨ Fixed semantic colors
        plot.setSectionPaint(
                GroupType.EXPENSE.getDisplayName(),
                new Color(220, 53, 69)   // Red for Expenses
        );

        plot.setSectionPaint(
                GroupType.SAVING.getDisplayName(),
                new Color(40, 167, 69)   // Green for Savings
        );

        plot.setBackgroundPaint(Color.WHITE);
        plot.setOutlineVisible(false);

        ChartPanel chartPanel = new ChartPanel(chart);
        chartPanel.setPreferredSize(new Dimension(420, 260));
        chartPanel.setMouseWheelEnabled(true);

        chartHolder.add(chartPanel, BorderLayout.CENTER);
        revalidate();
        repaint();
    }

    public void clear() {
        chartHolder.removeAll();
        repaint();
    }
}