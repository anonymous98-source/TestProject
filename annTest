package com.tcs.fincore.CommonMasterService.specification;

import com.tcs.fincore.CommonMasterService.dto.FilterRequest;
import org.springframework.data.jpa.domain.Specification;

import jakarta.persistence.criteria.Predicate;
import java.util.ArrayList;
import java.util.List;

public class GenericSpecification<T> {

    public static <T> Specification<T> build(List<FilterRequest> filters) {

        return (root, query, cb) -> {

            if (filters == null || filters.isEmpty()) {
                return cb.conjunction();
            }

            List<Predicate> predicates = new ArrayList<>();

            for (FilterRequest filter : filters) {

                String field = filter.getField();
                String operator = filter.getOperator();
                String value = filter.getValue();

                if (value == null || value.isBlank()) continue;

                if ("contains".equalsIgnoreCase(operator)) {
                    predicates.add(
                        cb.like(
                            cb.lower(root.get(field).as(String.class)),
                            "%" + value.toLowerCase() + "%"
                        )
                    );
                } else if ("equals".equalsIgnoreCase(operator)) {
                    predicates.add(
                        cb.equal(root.get(field), value)
                    );
                }
            }

            return cb.and(predicates.toArray(new Predicate[0]));
        };
    }
} 



package com.tcs.fincore.CommonMasterService.resolver;

import com.tcs.fincore.CommonMasterService.enums.MasterType;
import com.tcs.fincore.CommonMasterService.repository.BranchMasterRepository;
import com.tcs.fincore.CommonMasterService.repository.CGLMasterRepository;
import lombok.RequiredArgsConstructor;
import org.springframework.data.jpa.repository.JpaSpecificationExecutor;
import org.springframework.stereotype.Component;

@Component
@RequiredArgsConstructor
public class MasterResolver {

    private final CGLMasterRepository cglRepo;
    private final BranchMasterRepository branchRepo;

    public JpaSpecificationExecutor<?> resolve(MasterType masterType) {

        return switch (masterType) {
            case CGL -> cglRepo;
            case BRANCH -> branchRepo;
        };
    }
}



package com.tcs.fincore.CommonMasterService.service;

import com.tcs.fincore.CommonMasterService.dto.PaginatedResponseDto;
import com.tcs.fincore.CommonMasterService.dto.SearchRequest;
import com.tcs.fincore.CommonMasterService.resolver.MasterResolver;
import com.tcs.fincore.CommonMasterService.specification.GenericSpecification;
import lombok.RequiredArgsConstructor;
import org.springframework.data.domain.Page;
import org.springframework.data.domain.PageRequest;
import org.springframework.data.jpa.repository.JpaSpecificationExecutor;
import org.springframework.stereotype.Service;

@Service
@RequiredArgsConstructor
public class GenericMasterServiceImpl implements GenericMasterService {

    private final MasterResolver resolver;

    @Override
    public PaginatedResponseDto<?> search(SearchRequest request) {

        JpaSpecificationExecutor<?> repo =
                resolver.resolve(request.getMasterType());

        PageRequest pageRequest =
                PageRequest.of(request.getPage(), request.getSize());

        Page<?> page = repo.findAll(
                GenericSpecification.build(request.getFilters()),
                pageRequest
        );

        PaginatedResponseDto<Object> response = new PaginatedResponseDto<>();
        response.setData(page.getContent());
        response.setCurrentPage(page.getNumber());
        response.setPageSize(page.getSize());
        response.setTotalPages(page.getTotalPages());
        response.setTotalElements(page.getTotalElements());

        return response;
    }
}
