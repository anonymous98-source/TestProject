package com.kpmg.filehash.ui;

import com.kpmg.filehash.service.HashService;
import com.kpmg.filehash.constants.HashAlgorithm;

import javax.swing.*;
import javax.swing.border.EmptyBorder;
import java.awt.*;
import java.awt.datatransfer.StringSelection;
import java.io.File;

public class FileHashGenerator extends JFrame {

    private JTextField fileField;
    private JComboBox<HashAlgorithm> algorithmBox;
    private JTextArea resultArea;
    private File selectedFile;

    public FileHashGenerator() {
        setTitle("File Hash Generator");
        setSize(600, 350);
        setLocationRelativeTo(null);
        setDefaultCloseOperation(EXIT_ON_CLOSE);

        initUI();
    }

    private void initUI() {
        JPanel root = new JPanel(new BorderLayout(10, 10));
        root.setBorder(new EmptyBorder(15, 15, 15, 15));
        setContentPane(root);

        /* ---------- TOP PANEL ---------- */
        JPanel topPanel = new JPanel(new GridBagLayout());
        GridBagConstraints gbc = new GridBagConstraints();
        gbc.insets = new Insets(5, 5, 5, 5);
        gbc.fill = GridBagConstraints.HORIZONTAL;

        fileField = new JTextField();
        fileField.setEditable(false);

        JButton browseBtn = new JButton("Browse");
        browseBtn.addActionListener(e -> chooseFile());

        gbc.gridx = 0; gbc.gridy = 0; gbc.weightx = 1;
        topPanel.add(fileField, gbc);

        gbc.gridx = 1; gbc.weightx = 0;
        topPanel.add(browseBtn, gbc);

        root.add(topPanel, BorderLayout.NORTH);

        /* ---------- CENTER PANEL ---------- */
        JPanel centerPanel = new JPanel(new FlowLayout(FlowLayout.LEFT, 10, 10));

        algorithmBox = new JComboBox<>(HashAlgorithm.values());
        JButton generateBtn = new JButton("Generate Hash");
        generateBtn.addActionListener(e -> generateHash());

        centerPanel.add(new JLabel("Algorithm:"));
        centerPanel.add(algorithmBox);
        centerPanel.add(generateBtn);

        root.add(centerPanel, BorderLayout.CENTER);

        /* ---------- RESULT PANEL ---------- */
        resultArea = new JTextArea(5, 40);
        resultArea.setLineWrap(true);
        resultArea.setWrapStyleWord(true);
        resultArea.setEditable(false);
        resultArea.setBorder(BorderFactory.createEmptyBorder(5, 5, 5, 5));

        JScrollPane scrollPane = new JScrollPane(resultArea);
        scrollPane.setBorder(BorderFactory.createTitledBorder("Hash Output"));

        root.add(scrollPane, BorderLayout.SOUTH);

        /* ---------- BOTTOM PANEL ---------- */
        JPanel bottomPanel = new JPanel(new FlowLayout(FlowLayout.RIGHT));

        JButton copyBtn = new JButton("Copy to Clipboard");
        copyBtn.addActionListener(e -> copyToClipboard());

        bottomPanel.add(copyBtn);
        root.add(bottomPanel, BorderLayout.PAGE_END);
    }

    private void chooseFile() {
        JFileChooser chooser = new JFileChooser();
        if (chooser.showOpenDialog(this) == JFileChooser.APPROVE_OPTION) {
            selectedFile = chooser.getSelectedFile();
            fileField.setText(selectedFile.getAbsolutePath());
        }
    }

    private void generateHash() {
        if (selectedFile == null) {
            JOptionPane.showMessageDialog(this, "Please select a file.");
            return;
        }

        try {
            HashAlgorithm algo = (HashAlgorithm) algorithmBox.getSelectedItem();
            String hash = HashService.generateHash(
                    selectedFile, algo.getAlgorithm()
            );
            resultArea.setText(hash);
        } catch (Exception ex) {
            JOptionPane.showMessageDialog(this,
                    "Error generating hash: " + ex.getMessage());
        }
    }

    private void copyToClipboard() {
        String text = resultArea.getText();
        if (text == null || text.isEmpty()) return;

        Toolkit.getDefaultToolkit()
                .getSystemClipboard()
                .setContents(new StringSelection(text), null);

        JOptionPane.showMessageDialog(this, "Hash copied to clipboard!");
    }
}