
-------------- service -----------------------------------

@Override
    public ResponseEntity<List<Map<String, Object>>> getFrnDetails(List<String> frnList, Map<String, Object> user) {
        List<Map<String, Object>> frnDetails = empanelmentRepository.getFrnDetails(frnList);
        log.info("getFrnDetails: {}", frnDetails);
        String loggedUserRole = (String) user.get(ACCESS);
        List<Map<String, Object>> updatedFrnDetails = frnDetails.stream().map(originalMap -> {
            Map<String, Object> map = new HashMap<>(originalMap);
            String frnNumber = (String) map.get("FRN");
            int frnCount = getCount(frnNumber, loggedUserRole, user.get(FINANCIAL_YEAR).toString());
            if (frnCount == 0) {
                map.put("ELIGIBLE", "YES");
            } else {
                map.put("ELIGIBLE", "NO");
            }
            map.put("PROCESSED_BY", "System");
            map.put("TIMESTAMP", LocalDateTime.now().toString());
            return map;
        }).toList();

        return ResponseEntity.ok(updatedFrnDetails);
    }

----------- Repository -----------------------------------

@Query(nativeQuery = true, value = """
            SELECT
                frn,
                firm_name,
                empaneled_status AS already_empaneled,
                empanelment_type
                || '-'
                || (
                    SELECT
                        ASSIGNMENT_SUBTYPE
                    FROM
                        iam_assignment_type_master
                    WHERE
                        assignment_type_id = TO_NUMBER(empanelment_sub_type)
                )                AS empanelment_for,
                empaneled_by
            FROM
                iam_firm_empanelment
            WHERE
                frn IN ( :frnList )
            """)
    List<Map<String, Object>> getFrnDetails(@Param("frnList") List<String> frnList);
